<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ContextMenu?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Menu?>
<?import javafx.scene.control.MenuBar?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ProgressBar?>
<?import javafx.scene.control.RadioButton?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.SeparatorMenuItem?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.control.ToolBar?>
<?import javafx.scene.layout.AnchorPane?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>

<AnchorPane prefHeight="503.0" prefWidth="930.0" xmlns="http://javafx.com/javafx/8.0.111" xmlns:fx="http://javafx.com/fxml/1" fx:controller="xal.app.trajectorycorrection.FXMLController">
    <children>
     <MenuBar prefHeight="29.0" prefWidth="930.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="0.0">
       <menus>
         <Menu mnemonicParsing="false" text="File">
           <items>
             <MenuItem fx:id="exitMenu" mnemonicParsing="false" onAction="#handleMenuExit" text="Exit" />
           </items>
         </Menu>
            <Menu mnemonicParsing="false" text="Select BPMs">
               <items>
                  <MenuItem mnemonicParsing="false" onAction="#handleMenuSelectBPM" text="Select" />
               </items>
            </Menu>
         <Menu mnemonicParsing="false" text="Help">
           <items>
             <MenuItem mnemonicParsing="false" text="About" />
           </items>
         </Menu>
       </menus>
     </MenuBar>
      <VBox layoutY="-44.0" prefHeight="438.0" prefWidth="930.0" AnchorPane.bottomAnchor="37.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" AnchorPane.topAnchor="29.0">
        <children>
            <AnchorPane prefHeight="32.0" prefWidth="930.0">
               <children>
                  <Label layoutY="2.0" text="Reference Trajectory Files" AnchorPane.leftAnchor="5.0">
                     <font>
                        <Font size="20.0" />
                     </font>
                  </Label>
               </children>
            </AnchorPane>
           <TableView fx:id="tableView" editable="true" prefHeight="142.0" prefWidth="930.0">
             <columns>
               <TableColumn fx:id="selectColumn" editable="true" prefWidth="75.0" sortable="false" text="Select" />
               <TableColumn fx:id="nameColumn" editable="false" prefWidth="219.0" sortable="false" text="Name" />
                 <TableColumn fx:id="fileColumn" editable="false" prefWidth="635.0" sortable="false" text="File" />
             </columns>
              <contextMenu>
                 <ContextMenu>
                   <items>
                     <MenuItem fx:id="contexMenuLoad" mnemonicParsing="false" onAction="#handleContextMenuLoad" text="Load Trajectory" />
                       <MenuItem fx:id="contexMenuSave" mnemonicParsing="false" onAction="#handleContextMenuSave" text="Save Trajectory" />
                       <SeparatorMenuItem mnemonicParsing="false" />
                       <MenuItem fx:id="contexMenuShow" mnemonicParsing="false" onAction="#handleContextMenuShow" text="Show Selected Traj." />
                       <MenuItem mnemonicParsing="false" onAction="#handleContextMenuDelete" text="Delete Selected Traj." />
                   </items>
                 </ContextMenu>
              </contextMenu>
           </TableView>
           <Separator prefWidth="200.0" />
           <TabPane prefHeight="269.0" prefWidth="930.0" tabClosingPolicy="UNAVAILABLE">
             <tabs>
               <Tab text="1-to-1 correction">
                 <content>
                   <AnchorPane minHeight="241.0" minWidth="930.0" prefHeight="241.0" prefWidth="930.0">
                          <children>
                             <GridPane layoutX="14.0" layoutY="22.0" prefHeight="137.0" prefWidth="200.0" AnchorPane.leftAnchor="14.0" AnchorPane.topAnchor="22.0">
                               <columnConstraints>
                                 <ColumnConstraints halignment="CENTER" hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                               </columnConstraints>
                               <rowConstraints>
                                 <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                 <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                   <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                 <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                               </rowConstraints>
                                <children>
                                   <Button fx:id="buttonPairBPMCorrector" mnemonicParsing="false" onAction="#handlePairBPMCorrector" prefHeight="27.0" prefWidth="180.0" text="Pair BPM + Steerer" />
                                   <Button fx:id="buttonMeasureResponse1to1" disable="true" mnemonicParsing="false" onAction="#handleMeasureResponse1to1" prefWidth="180.0" text="Measure Response" GridPane.rowIndex="1" />
                                   <Button disable="true" mnemonicParsing="false" prefWidth="180.0" text="Response from Model" GridPane.rowIndex="2" />
                                   <Button disable="true" mnemonicParsing="false" prefWidth="180.0" text="Load Response Table" GridPane.rowIndex="3" />
                                </children>
                             </GridPane>
                             <GridPane layoutX="214.0" layoutY="22.0" prefHeight="137.0" prefWidth="200.0" AnchorPane.leftAnchor="214.0" AnchorPane.topAnchor="22.0">
                               <columnConstraints>
                                 <ColumnConstraints halignment="CENTER" hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                               </columnConstraints>
                               <rowConstraints>
                                 <RowConstraints maxHeight="77.0" minHeight="10.0" prefHeight="71.0" vgrow="SOMETIMES" />
                                 <RowConstraints maxHeight="97.0" minHeight="10.0" prefHeight="66.0" vgrow="SOMETIMES" />
                               </rowConstraints>
                                <children>
                                   <GridPane>
                                     <columnConstraints>
                                       <ColumnConstraints hgrow="SOMETIMES" maxWidth="136.0" minWidth="10.0" prefWidth="133.0" />
                                       <ColumnConstraints hgrow="SOMETIMES" maxWidth="96.0" minWidth="10.0" prefWidth="67.0" />
                                     </columnConstraints>
                                     <rowConstraints>
                                       <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                     </rowConstraints>
                                      <children>
                                         <Label text="Correction factor (%)" />
                                         <TextField fx:id="textFieldCorrFactor1to1" promptText="Percentage of correction to be applied." text="100" GridPane.columnIndex="1" />
                                      </children>
                                   </GridPane>
                                   <Button fx:id="buttonCorrect1to1" disable="true" mnemonicParsing="false" onAction="#handleButtonCorrect1to1" prefHeight="52.0" prefWidth="132.0" text="CORRECT" GridPane.rowIndex="1" />
                                </children>
                             </GridPane>
                             <Label layoutX="24.0" layoutY="180.0" prefHeight="17.0" prefWidth="155.0" text="Select correction plane:" AnchorPane.leftAnchor="24.0" AnchorPane.topAnchor="180.0" />
                             <RadioButton fx:id="radioButtonHorVer" layoutX="218.0" layoutY="209.0" mnemonicParsing="false" text="Hor. + Vert." AnchorPane.leftAnchor="218.0" AnchorPane.topAnchor="209.0">
                                 <toggleGroup>
                                   <ToggleGroup fx:id="group1" />
                                 </toggleGroup>
                              </RadioButton>
                             <RadioButton fx:id="radioButtonVer" layoutX="126.0" layoutY="209.0" mnemonicParsing="false" text="Vertical" toggleGroup="$group1" AnchorPane.leftAnchor="126.0" AnchorPane.topAnchor="209.0" />
                             <RadioButton fx:id="radioButtonHor" layoutX="24.0" layoutY="209.0" mnemonicParsing="false" selected="true" text="Horizontal" toggleGroup="$group1" AnchorPane.leftAnchor="24.0" AnchorPane.topAnchor="209.0" />
                              <TextArea fx:id="textArea1to1" editable="false" layoutX="434.0" layoutY="18.0" prefHeight="200.0" prefWidth="475.0" AnchorPane.bottomAnchor="23.0" AnchorPane.leftAnchor="434.0" AnchorPane.rightAnchor="21.0" AnchorPane.topAnchor="18.0" />
                          </children>
                       </AnchorPane>
                 </content>
               </Tab>
               <Tab text="SVD correction">
                 <content>
                   <AnchorPane minHeight="241.0" minWidth="930.0" prefHeight="241.0" prefWidth="930.0">
                          <children>
                             <GridPane layoutX="14.0" layoutY="22.0" prefHeight="137.0" prefWidth="200.0" AnchorPane.leftAnchor="14.0" AnchorPane.topAnchor="22.0">
                                <columnConstraints>
                                   <ColumnConstraints halignment="CENTER" hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                </columnConstraints>
                                <rowConstraints>
                                   <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                   <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                   <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                    <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                </rowConstraints>
                                <children>
                                   <Button fx:id="buttonMeasureResponseSVD" mnemonicParsing="false" onAction="#handleMeasureResponseSVD" prefWidth="180.0" text="Measure Response Matrix" />
                                   <Button disable="true" mnemonicParsing="false" prefWidth="180.0" text="Load Response Matrix" GridPane.rowIndex="1" />
                                   <Button disable="true" mnemonicParsing="false" prefWidth="180.0" text="Matrix from Model" GridPane.rowIndex="2" />
                                    <Button fx:id="buttonShowSingularValues" disable="true" mnemonicParsing="false" prefWidth="180.0" text="Show Singular Values" GridPane.rowIndex="3" />
                                </children>
                             </GridPane>
                             <GridPane layoutX="214.0" layoutY="22.0" prefHeight="137.0" prefWidth="200.0" AnchorPane.leftAnchor="214.0" AnchorPane.topAnchor="22.0">
                                <columnConstraints>
                                   <ColumnConstraints halignment="CENTER" hgrow="SOMETIMES" minWidth="10.0" prefWidth="100.0" />
                                </columnConstraints>
                                <rowConstraints>
                                   <RowConstraints maxHeight="70.0" minHeight="10.0" prefHeight="62.0" vgrow="SOMETIMES" />
                                   <RowConstraints maxHeight="97.0" minHeight="10.0" prefHeight="39.0" vgrow="SOMETIMES" />
                                    <RowConstraints maxHeight="97.0" minHeight="10.0" prefHeight="39.0" vgrow="SOMETIMES" />
                                </rowConstraints>
                                <children>
                                   <GridPane prefHeight="60.0" prefWidth="200.0">
                                      <columnConstraints>
                                         <ColumnConstraints hgrow="SOMETIMES" maxWidth="136.0" minWidth="10.0" prefWidth="133.0" />
                                         <ColumnConstraints hgrow="SOMETIMES" maxWidth="96.0" minWidth="10.0" prefWidth="67.0" />
                                      </columnConstraints>
                                      <rowConstraints>
                                         <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                         <RowConstraints minHeight="10.0" prefHeight="30.0" vgrow="SOMETIMES" />
                                      </rowConstraints>
                                      <children>
                                         <Label text="Correction factor (%)" />
                                         <TextField fx:id="textFieldCorrFactorSVD" promptText="Percentage of correction to be applied." text="100" GridPane.columnIndex="1" />
                                         <Label text="singular value cut:" GridPane.rowIndex="1" />
                                         <TextField fx:id="textFieldSingularValCut" text="0" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                      </children>
                                   </GridPane>
                                    <Button fx:id="buttonCalcCorrectSVD" mnemonicParsing="false" onAction="#handleCalculateCorrectionSVD" prefHeight="35.0" prefWidth="132.0" text="Prepare" GridPane.rowIndex="1" />
                                   <Button fx:id="buttonCorrectSVD" disable="true" mnemonicParsing="false" onAction="#handleCorrectSVD" prefHeight="35.0" prefWidth="132.0" text="CORRECT!" GridPane.rowIndex="2" />
                                </children>
                             </GridPane>
                             <Label layoutX="24.0" layoutY="180.0" text="Select correction plane:" AnchorPane.leftAnchor="24.0" AnchorPane.topAnchor="180.0" />
                             <RadioButton fx:id="radioButtonHorSVD" layoutX="24.0" layoutY="209.0" mnemonicParsing="false" selected="true" text="Horizontal" AnchorPane.leftAnchor="24.0" AnchorPane.topAnchor="209.0">
                                 <toggleGroup>
                                   <ToggleGroup fx:id="groupSVD" />
                                 </toggleGroup>
                              </RadioButton>
                             <RadioButton fx:id="radioButtonVerSVD" layoutX="126.0" layoutY="209.0" mnemonicParsing="false" text="Vertical" toggleGroup="$groupSVD" AnchorPane.leftAnchor="126.0" AnchorPane.topAnchor="209.0" />
                             <RadioButton fx:id="radioButtonHorVerSVD" layoutX="218.0" layoutY="209.0" mnemonicParsing="false" text="Hor. + Vert." toggleGroup="$groupSVD" AnchorPane.leftAnchor="218.0" AnchorPane.topAnchor="209.0" />
                              <TextArea fx:id="textAreaSVDBPM" editable="false" layoutX="434.0" layoutY="18.0" prefHeight="200.0" prefWidth="230.0" AnchorPane.bottomAnchor="23.0" AnchorPane.leftAnchor="434.0" AnchorPane.topAnchor="18.0" />
                              <TextArea fx:id="textAreaSVDDialog" editable="false" layoutX="679.0" layoutY="18.0" prefHeight="200.0" prefWidth="230.0" AnchorPane.bottomAnchor="23.0" AnchorPane.leftAnchor="679.0" AnchorPane.rightAnchor="21.0" AnchorPane.topAnchor="18.0" />
                          </children></AnchorPane>
                 </content>
               </Tab>
             </tabs>
           </TabPane>
        </children>
    </VBox>
      <Separator layoutY="468.0" prefWidth="930.0" AnchorPane.bottomAnchor="32.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0" />
      <ToolBar layoutY="470.0" prefHeight="18.0" prefWidth="930.0" AnchorPane.bottomAnchor="0.0" AnchorPane.leftAnchor="0.0" AnchorPane.rightAnchor="0.0">
         <items>
            <ProgressBar fx:id="progressBarCorrection" prefHeight="20.0" prefWidth="257.0" progress="0.0" visible="false" />
            <Label fx:id="labelProgressCorrection" alignment="CENTER" contentDisplay="CENTER" text="Aquiring BPM response" visible="false" />
         </items>
      </ToolBar>
    </children>
</AnchorPane>
